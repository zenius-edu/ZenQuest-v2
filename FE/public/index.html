<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    
    <!-- NEW Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <!-- Enhanced Error Debugging Script -->
    <script>
      // Enhanced debug mode
      window.DEBUG_ERRORS = true;
      
      // Store original functions
      const originalConsoleError = console.error;
      const originalConsoleLog = console.log;
      
      // Enhanced console.error override
      console.error = function(...args) {
        const processedArgs = args.map((arg, index) => {
          // Check for [object Object] specifically
          if (arg && typeof arg === 'object' && arg.constructor === Object) {
            console.warn(`[DEBUG] Found object at index ${index}:`, arg);
            try {
              const serialized = JSON.stringify(arg, (key, value) => {
                // Handle circular references
                if (typeof value === 'object' && value !== null) {
                  if (this.seen && this.seen.has(value)) {
                    return '[Circular]';
                  }
                  if (!this.seen) this.seen = new WeakSet();
                  this.seen.add(value);
                }
                return value;
              }, 2);
              return `[OBJECT DETAILS]: ${serialized}`;
            } catch (e) {
              const keys = Object.keys(arg);
              const preview = keys.slice(0, 5).map(key => `${key}: ${typeof arg[key]}`).join(', ');
              return `[OBJECT PREVIEW]: {${preview}${keys.length > 5 ? '...' : ''}}`;
            }
          }
          
          // Handle Error objects specifically
          if (arg instanceof Error) {
            return `[ERROR]: ${arg.name}: ${arg.message}\nStack: ${arg.stack}`;
          }
          
          return arg;
        });
        
        // Log with stack trace
        if (window.DEBUG_ERRORS) {
          console.trace('[ERROR TRACE]');
        }
        
        originalConsoleError.apply(console, processedArgs);
      };

      // Track all function calls that might throw errors
      const originalSetTimeout = window.setTimeout;
      window.setTimeout = function(fn, delay, ...args) {
        const wrappedFn = function() {
          try {
            return fn.apply(this, args);
          } catch (error) {
            console.error('[TIMEOUT ERROR]:', error);
            throw error;
          }
        };
        return originalSetTimeout(wrappedFn, delay);
      };

      // Enhanced global error handler
      window.addEventListener('error', function(event) {
        console.error('[GLOBAL ERROR] Caught unhandled error:', {
          message: event.message,
          filename: event.filename,
          lineno: event.lineno,
          colno: event.colno,
          error: event.error,
          stack: event.error ? event.error.stack : 'No stack trace'
        });
        
        // Prevent default error handling to avoid duplicate logs
        event.preventDefault();
      });

      // Enhanced unhandled promise rejection handler  
      window.addEventListener('unhandledrejection', function(event) {
        console.error('[UNHANDLED PROMISE REJECTION]:', {
          reason: event.reason,
          promise: event.promise,
          stack: event.reason && event.reason.stack ? event.reason.stack : 'No stack trace'
        });
        
        // Prevent default to avoid duplicate logs
        event.preventDefault();
      });

      // Monitor React errors specifically
      if (window.React) {
        console.log('[DEBUG] React detected, setting up React error monitoring');
      }
    </script>
    
    <title>ZenQuest - Learn Anything</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
  </body>
</html>
